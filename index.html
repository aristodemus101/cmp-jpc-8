<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CMP GD Tracker</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@heroicons/react/24/outline/esm/index.js" type="module"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50">
  <div id="root"></div>

  <script type="text/babel">
    // ================== FIREBASE SETUP ==================
        const firebaseConfig = {
          apiKey: "AIzaSyA0WITtGofY4WvQb08sZ96RNLE1rM5_Udw",
          authDomain: "iift-mentorship-project.firebaseapp.com",
          projectId: "iift-mentorship-project",
          storageBucket: "iift-mentorship-project.firebasestorage.app",
          messagingSenderId: "185893652365",
          appId: "1:185893652365:web:2e45a3833c1088a39d1fc4",
          measurementId: "G-QQKZG0YEDY"
        };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ================== MAIN APP ==================
    const GDTracker = () => {
      const [gdList, setGdList] = React.useState([]);
      const [showForm, setShowForm] = React.useState(false);
      const [loading, setLoading] = React.useState(true);
      const [newGD, setNewGD] = React.useState({
        timeSlot: "",
        groupName: "",
        meetLink: "",
        students: [],
        panelists: [],
        spocs: "",
        status: "Scheduled",
      });

      // ---- Fetch existing GDs ----
      React.useEffect(() => {
        const unsub = db.collection("gd-tracker").onSnapshot((snap) => {
          setGdList(snap.docs.map((doc) => ({ id: doc.id, ...doc.data() })));
          setLoading(false);
        });
        return () => unsub();
      }, []);

      // ---- Add GD ----
      const handleAddGD = async () => {
        if (!newGD.timeSlot || !newGD.groupName) return alert("Fill all mandatory fields");
        await db.collection("gd-tracker").add(newGD);
        setNewGD({
          timeSlot: "",
          groupName: "",
          meetLink: "",
          students: [],
          panelists: [],
          spocs: "",
          status: "Scheduled",
        });
        setShowForm(false);
      };

      // ---- Add/Remove Helpers ----
      const addStudent = () => setNewGD({ ...newGD, students: [...newGD.students, { name: "", email: "", attachment: "" }] });
      const addPanelist = () => setNewGD({ ...newGD, panelists: [...newGD.panelists, { name: "", email: "", phone: "" }] });
      const updateStudent = (i, k, v) => {
        const s = [...newGD.students]; s[i][k] = v; setNewGD({ ...newGD, students: s });
      };
      const updatePanelist = (i, k, v) => {
        const p = [...newGD.panelists]; p[i][k] = v; setNewGD({ ...newGD, panelists: p });
      };
      const removeStudent = (i) => setNewGD({ ...newGD, students: newGD.students.filter((_, idx) => idx !== i) });
      const removePanelist = (i) => setNewGD({ ...newGD, panelists: newGD.panelists.filter((_, idx) => idx !== i) });

      // ---- UI ----
      return (
        <div className="max-w-5xl mx-auto py-8 px-4">
          <div className="flex justify-between items-center mb-6">
            <h1 className="text-3xl font-bold text-indigo-700">CMP GD Tracker</h1>
            <button
              onClick={() => setShowForm(!showForm)}
              className="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700"
            >
              {showForm ? "Close" : "Add New GD"}
            </button>
          </div>

          {showForm && (
            <div className="bg-white shadow-lg rounded-xl p-6 mb-8">
              <h2 className="text-lg font-semibold mb-4 text-gray-800">Add New GD</h2>

              <div className="grid md:grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium mb-1">Time Slot*</label>
                  <input
                    type="text"
                    value={newGD.timeSlot}
                    onChange={(e) => setNewGD({ ...newGD, timeSlot: e.target.value })}
                    placeholder="e.g., 12â€“2 PM"
                    className="w-full border rounded px-3 py-2"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium mb-1">Group Name*</label>
                  <input
                    type="text"
                    value={newGD.groupName}
                    onChange={(e) => setNewGD({ ...newGD, groupName: e.target.value })}
                    placeholder="e.g., CMP - GD 5"
                    className="w-full border rounded px-3 py-2"
                  />
                </div>
              </div>

              <div className="mt-3">
                <label className="block text-sm font-medium mb-1">Meet Link</label>
                <input
                  type="text"
                  value={newGD.meetLink}
                  onChange={(e) => setNewGD({ ...newGD, meetLink: e.target.value })}
                  placeholder="Paste Meet / Zoom link"
                  className="w-full border rounded px-3 py-2"
                />
              </div>

              {/* STUDENTS */}
              <div className="mt-4">
                <div className="flex justify-between mb-2">
                  <label className="font-medium">Students</label>
                  <button onClick={addStudent} className="text-indigo-600 text-sm">+ Add Student</button>
                </div>
                {newGD.students.length === 0 ? (
                  <p className="text-gray-500 text-sm">No students added yet.</p>
                ) : (
                  newGD.students.map((s, i) => (
                    <div key={i} className="grid md:grid-cols-3 gap-2 mb-2">
                      <input
                        type="text"
                        placeholder="Name"
                        value={s.name}
                        onChange={(e) => updateStudent(i, "name", e.target.value)}
                        className="border rounded px-2 py-1"
                      />
                      <input
                        type="email"
                        placeholder="Email"
                        value={s.email}
                        onChange={(e) => updateStudent(i, "email", e.target.value)}
                        className="border rounded px-2 py-1"
                      />
                      <input
                        type="url"
                        placeholder="Attachment link"
                        value={s.attachment}
                        onChange={(e) => updateStudent(i, "attachment", e.target.value)}
                        className="border rounded px-2 py-1"
                      />
                      <button
                        onClick={() => removeStudent(i)}
                        className="text-red-600 text-xs col-span-3 text-right"
                      >
                        Remove
                      </button>
                    </div>
                  ))
                )}
              </div>

              {/* PANELISTS */}
              <div className="mt-4">
                <div className="flex justify-between mb-2">
                  <label className="font-medium">Panelists</label>
                  <button onClick={addPanelist} className="text-indigo-600 text-sm">+ Add Panelist</button>
                </div>
                {newGD.panelists.length === 0 ? (
                  <p className="text-gray-500 text-sm">No panelists added yet.</p>
                ) : (
                  newGD.panelists.map((p, i) => (
                    <div key={i} className="grid md:grid-cols-3 gap-2 mb-2">
                      <input
                        type="text"
                        placeholder="Name"
                        value={p.name}
                        onChange={(e) => updatePanelist(i, "name", e.target.value)}
                        className="border rounded px-2 py-1"
                      />
                      <input
                        type="email"
                        placeholder="Email"
                        value={p.email}
                        onChange={(e) => updatePanelist(i, "email", e.target.value)}
                        className="border rounded px-2 py-1"
                      />
                      <input
                        type="text"
                        placeholder="Phone"
                        value={p.phone}
                        onChange={(e) => updatePanelist(i, "phone", e.target.value)}
                        className="border rounded px-2 py-1"
                      />
                      <button
                        onClick={() => removePanelist(i)}
                        className="text-red-600 text-xs col-span-3 text-right"
                      >
                        Remove
                      </button>
                    </div>
                  ))
                )}
              </div>

              {/* SPOC */}
              <div className="mt-3">
                <label className="block text-sm font-medium mb-1">SPOCs</label>
                <input
                  type="text"
                  value={newGD.spocs}
                  onChange={(e) => setNewGD({ ...newGD, spocs: e.target.value })}
                  placeholder="Comma separated names / contacts"
                  className="w-full border rounded px-3 py-2"
                />
              </div>

              {/* ADD BUTTON */}
              <div className="text-right mt-5">
                <button
                  onClick={handleAddGD}
                  className="bg-indigo-600 text-white px-5 py-2 rounded-lg hover:bg-indigo-700"
                >
                  Add GD
                </button>
              </div>
            </div>
          )}

          {/* GD LIST */}
          {loading ? (
            <p className="text-gray-500 text-center mt-10">Loading...</p>
          ) : gdList.length === 0 ? (
            <p className="text-gray-500 text-center mt-10">No GDs added yet.</p>
          ) : (
            <div className="space-y-4">
              {gdList.map((gd) => (
                <div key={gd.id} className="bg-white p-5 rounded-lg shadow flex justify-between items-start">
                  <div>
                    <h3 className="font-semibold text-lg">{gd.groupName}</h3>
                    <p className="text-sm text-gray-600">ðŸ•’ {gd.timeSlot}</p>
                    <p className="text-sm mt-1">Panelists: {gd.panelists.length}</p>
                    <p className="text-sm">Students: {gd.students.length}</p>
                    {gd.meetLink && (
                      <a
                        href={gd.meetLink}
                        target="_blank"
                        className="text-indigo-600 text-sm underline mt-2 block"
                      >
                        Join Meet
                      </a>
                    )}
                  </div>
                  <span
                    className={`text-xs px-3 py-1 rounded-full ${
                      gd.status === "Completed"
                        ? "bg-green-100 text-green-800"
                        : "bg-yellow-100 text-yellow-800"
                    }`}
                  >
                    {gd.status}
                  </span>
                </div>
              ))}
            </div>
          )}
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById("root")).render(<GDTracker />);
  </script>
</body>
</html>
