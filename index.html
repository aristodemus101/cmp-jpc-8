<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>CMP 8.0 Tracker - Real-time</title>

    <!-- React UMD -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase Compat -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body class="bg-slate-50">
  <div id="root"></div>

  <script type="text/babel">
    const firebaseConfig = {
      apiKey: "AIzaSyA0WITtGofY4WvQb08sZ96RNLE1rM5_Udw",
      authDomain: "iift-mentorship-project.firebaseapp.com",
      projectId: "iift-mentorship-project",
      storageBucket: "iift-mentorship-project.firebasestorage.app",
      messagingSenderId: "185893652365",
      appId: "1:185893652365:web:2e45a3833c1088a39d1fc4",
      measurementId: "G-QQKZG0YEDY"
    };

    // Initialize Firebase (compat)
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.firestore();

    const { useState, useEffect, useRef } = React;

    const Icons = {
      Plus: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
      Users: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>,
      Calendar: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>,
      Edit: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>,
      Trash: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>,
      Download: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>,
      Save: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>,
      X: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>,
      Paperclip: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg>
    };

    function calculateStatsFromGroups(groups) {
      const totalGDs = groups.length;
      const completedGDs = groups.filter(g => g.status === 'completed').length;
      const inProgressGDs = groups.filter(g => g.status === 'in-progress').length;
      const pendingGDs = groups.filter(g => g.status === 'pending').length;

      const studentsInCompleted = groups
        .filter(g => g.status === 'completed')
        .reduce((s, g) => s + (g.students?.length || 0), 0);

      const studentsInInProgress = groups
        .filter(g => g.status === 'in-progress')
        .reduce((s, g) => s + (g.students?.length || 0), 0);

      const studentsInPending = groups
        .filter(g => g.status === 'pending')
        .reduce((s, g) => s + (g.students?.length || 0), 0);

      const totalStudentsDerived = studentsInCompleted + studentsInInProgress + studentsInPending;

      return {
        totalGDs,
        completedGDs,
        inProgressGDs,
        pendingGDs,
        studentsInCompleted,
        studentsInInProgress,
        studentsInPending,
        totalStudentsDerived
      };
    }

    const GDTracker = () => {
      const [gdGroups, setGdGroups] = useState([]);
      const [stats, setStats] = useState({
        totalStudents: 0,
        studentsInPI: 0,
        studentsInGD: 0,
        totalMentors: 0,
        totalGDs: 0
      });
      const [tempStats, setTempStats] = useState({ ...stats });
      const [editingStats, setEditingStats] = useState(false);

      const [selectedView, setSelectedView] = useState('tracker');
      const [loading, setLoading] = useState(true);

      const [newGD, setNewGD] = useState({
        timing: '',
        groupName: '',
        students: [],
        meetLink: '',
        panelists: [],
        spocs: '',
        status: 'pending'
      });

      const [editingGD, setEditingGD] = useState(null);

      const editingStatsRef = useRef(false);

      // Real-time listener for gdGroups
      useEffect(() => {
        const unsubscribe = db.collection('gdGroups').orderBy('createdAt', 'desc').onSnapshot(snapshot => {
          const groups = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
          setGdGroups(groups);

          const derived = calculateStatsFromGroups(groups);

          if (!editingStatsRef.current) {
            db.collection('stats').doc('dashboard').get().then(docSnap => {
              const current = docSnap.exists ? docSnap.data() : {};
              const toUpdate = {};
              if (current.totalGDs !== derived.totalGDs) toUpdate.totalGDs = derived.totalGDs;
              if (current.derivedTotalStudents !== derived.totalStudentsDerived) toUpdate.derivedTotalStudents = derived.totalStudentsDerived;
              if ((current.totalStudents === undefined || current.totalStudents === null) && derived.totalStudentsDerived !== undefined) {
                toUpdate.totalStudents = derived.totalStudentsDerived;
              }
              if (Object.keys(toUpdate).length > 0) {
                db.collection('stats').doc('dashboard').set(toUpdate, { merge: true }).catch(e => console.error('Error syncing derived stats:', e));
              }
            }).catch(e => console.error(e));
          }

          setLoading(false);
        });

        return () => unsubscribe();
      }, []);

      // Real-time listener for stats doc
      useEffect(() => {
        const unsubscribe = db.collection('stats').doc('dashboard').onSnapshot(doc => {
          if (doc.exists) {
            const d = doc.data();
            setStats({
              totalStudents: d.totalStudents ?? 0,
              studentsInPI: d.studentsInPI ?? 0,
              studentsInGD: d.studentsInGD ?? 0,
              totalMentors: d.totalMentors ?? 0,
              totalGDs: d.totalGDs ?? 0,
              derivedTotalStudents: d.derivedTotalStudents ?? 0
            });
            setTempStats({
              totalStudents: d.totalStudents ?? 0,
              studentsInPI: d.studentsInPI ?? 0,
              studentsInGD: d.studentsInGD ?? 0,
              totalMentors: d.totalMentors ?? 0,
              totalGDs: d.totalGDs ?? 0
            });
          } else {
            db.collection('stats').doc('dashboard').set({
              totalStudents: 0,
              studentsInPI: 0,
              studentsInGD: 0,
              totalMentors: 0,
              totalGDs: 0,
              derivedTotalStudents: 0
            }).catch(e => console.error(e));
          }
        });

        return () => unsubscribe();
      }, []);

      const addStudent = () => {
        setNewGD({
          ...newGD,
          students: [...newGD.students, { name: '', email: '', attachment: '' }]
        });
      };

      const updateStudent = (index, field, value) => {
        const arr = [...newGD.students];
        arr[index][field] = value;
        setNewGD({ ...newGD, students: arr });
      };

      const removeStudent = (index) => {
        setNewGD({ ...newGD, students: newGD.students.filter((_, i) => i !== index) });
      };

      const addPanelist = () => {
        setNewGD({
          ...newGD,
          panelists: [...newGD.panelists, { name: '', email: '', phone: '' }]
        });
      };

      const updatePanelist = (index, field, value) => {
        const arr = [...newGD.panelists];
        arr[index][field] = value;
        setNewGD({ ...newGD, panelists: arr });
      };

      const removePanelist = (index) => {
        setNewGD({ ...newGD, panelists: newGD.panelists.filter((_, i) => i !== index) });
      };

      const handleAddGD = async () => {
        try {
          await db.collection('gdGroups').add({
            ...newGD,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
          setNewGD({
            timing: '',
            groupName: '',
            students: [],
            meetLink: '',
            panelists: [],
            spocs: '',
            status: 'pending'
          });
          setSelectedView('tracker');
          alert('GD added successfully!');
        } catch (error) {
          console.error('Error adding GD:', error);
          alert('Error adding GD: ' + error.message);
        }
      };

      const handleUpdateGD = async (id, field, value) => {
        try {
          await db.collection('gdGroups').doc(id).update({ [field]: value });
        } catch (error) {
          console.error('Error updating GD:', error);
        }
      };

      const handleDeleteGD = async (id) => {
        if (!window.confirm('Are you sure you want to delete this GD?')) return;
        try {
          await db.collection('gdGroups').doc(id).delete();
          alert('GD deleted successfully!');
        } catch (error) {
          console.error('Error deleting GD:', error);
          alert('Error deleting GD: ' + error.message);
        }
      };

      // Edit GD functions
      const startEditingGD = (gd) => {
        setEditingGD({
          id: gd.id,
          timing: gd.timing || '',
          groupName: gd.groupName || '',
          students: gd.students ? [...gd.students] : [],
          meetLink: gd.meetLink || '',
          panelists: gd.panelists ? [...gd.panelists] : [],
          spocs: gd.spocs || '',
          status: gd.status || 'pending'
        });
      };

      const cancelEditingGD = () => {
        setEditingGD(null);
      };

      const saveEditingGD = async () => {
        if (!editingGD) return;
        try {
          const { id, ...data } = editingGD;
          await db.collection('gdGroups').doc(id).update(data);
          setEditingGD(null);
          alert('GD updated successfully!');
        } catch (error) {
          console.error('Error updating GD:', error);
          alert('Error updating GD: ' + error.message);
        }
      };

      const updateEditingGDStudent = (index, field, value) => {
        const arr = [...editingGD.students];
        arr[index][field] = value;
        setEditingGD({ ...editingGD, students: arr });
      };

      const removeEditingGDStudent = (index) => {
        setEditingGD({ ...editingGD, students: editingGD.students.filter((_, i) => i !== index) });
      };

      const addEditingGDStudent = () => {
        setEditingGD({ ...editingGD, students: [...editingGD.students, { name: '', email: '', attachment: '' }] });
      };

      const updateEditingGDPanelist = (index, field, value) => {
        const arr = [...editingGD.panelists];
        arr[index][field] = value;
        setEditingGD({ ...editingGD, panelists: arr });
      };

      const removeEditingGDPanelist = (index) => {
        setEditingGD({ ...editingGD, panelists: editingGD.panelists.filter((_, i) => i !== index) });
      };

      const addEditingGDPanelist = () => {
        setEditingGD({ ...editingGD, panelists: [...editingGD.panelists, { name: '', email: '', phone: '' }] });
      };

      const handleStatsChange = (field, value) => {
        const numValue = value === '' ? 0 : parseInt(value) || 0;
        setTempStats({ ...tempStats, [field]: numValue });
      };

      const handleSaveStats = async () => {
        try {
          editingStatsRef.current = false;
          await db.collection('stats').doc('dashboard').set({
            totalStudents: tempStats.totalStudents,
            studentsInPI: tempStats.studentsInPI ?? 0,
            studentsInGD: tempStats.studentsInGD ?? 0,
            totalMentors: tempStats.totalMentors ?? 0,
            totalGDs: tempStats.totalGDs ?? 0
          }, { merge: true });
          setEditingStats(false);
          alert('Stats updated successfully!');
        } catch (error) {
          console.error('Error updating stats:', error);
          alert('Error updating stats: ' + error.message);
        } finally {
          editingStatsRef.current = false;
        }
      };

      const startEditingStats = () => {
        editingStatsRef.current = true;
        setEditingStats(true);
        setTempStats({
          totalStudents: stats.totalStudents ?? 0,
          studentsInPI: stats.studentsInPI ?? 0,
          studentsInGD: stats.studentsInGD ?? 0,
          totalMentors: stats.totalMentors ?? 0,
          totalGDs: stats.totalGDs ?? gdGroups.length
        });
      };

      const handleCancelEdit = () => {
        editingStatsRef.current = false;
        setTempStats({
          totalStudents: stats.totalStudents ?? 0,
          studentsInPI: stats.studentsInPI ?? 0,
          studentsInGD: stats.studentsInGD ?? 0,
          totalMentors: stats.totalMentors ?? 0,
          totalGDs: stats.totalGDs ?? gdGroups.length
        });
        setEditingStats(false);
      };

      const exportToCSV = () => {
        const headers = ['Timing', 'Group', 'Students', 'Meet Link', 'Panelists', 'SPOCs', 'Status'];
        const rows = gdGroups.map(gd => [
          gd.timing,
          gd.groupName,
          gd.students?.map(s => `${s.name} (${s.email})`).join('; ') || '',
          gd.meetLink,
          gd.panelists?.map(p => `${p.name} - ${p.phone}`).join('; ') || '',
          gd.spocs,
          gd.status
        ]);
        const csvContent = [headers, ...rows].map(r => r.map(cell => `"${String(cell || '').replace(/"/g, '""')}"`).join(',')).join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'gd_tracker.csv';
        link.click();
      };

      const derived = calculateStatsFromGroups(gdGroups);

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-50 to-indigo-50 p-6">
          <div className="max-w-7xl mx-auto">
            <div className="bg-white rounded-2xl shadow-md p-6 mb-6">
              <div className="flex items-center justify-between mb-6">
                <div>
                  <h1 className="text-3xl font-bold text-indigo-900">CMP 8.0 Tracker</h1>
                  <p className="text-sm text-slate-600">Real-time Sync â€¢ Lesgoooo</p>
                </div>

                <div className="flex items-center gap-3">
                  <button
                    onClick={exportToCSV}
                    className="flex items-center gap-2 bg-emerald-600 text-white px-4 py-2 rounded-lg hover:bg-emerald-700"
                  >
                    <Icons.Download />
                    Export CSV
                  </button>
                </div>
              </div>

              {/* Stats Row */}
              <div className="grid grid-cols-3 gap-4 mb-6">
                {/* Total Students card */}
                <div className="bg-gradient-to-br from-blue-50 to-white p-4 rounded-lg border shadow-sm">
                  <div className="flex items-center justify-between mb-2">
                    <div className="flex items-center gap-2">
                      <Icons.Users className="text-blue-600" />
                      <div>
                        <div className="text-xs text-slate-500">Total Students</div>
                        {!editingStats ? (
                          <div className="text-3xl font-bold text-blue-700">{stats.totalStudents ?? 0}</div>
                        ) : (
                          <input
                            type="number"
                            value={tempStats.totalStudents ?? ''}
                            onChange={(e) => handleStatsChange('totalStudents', e.target.value)}
                            className="text-3xl font-bold text-blue-700 border rounded px-2 py-1 w-28"
                          />
                        )}
                      </div>
                    </div>

                    {!editingStats && (
                      <button onClick={startEditingStats} className="text-slate-600 p-1 hover:text-slate-800">
                        <Icons.Edit />
                      </button>
                    )}
                  </div>

                  <div className="text-sm text-slate-600 mt-2">
                    <div className="flex justify-between items-center">
                      <div>In PI</div>
                      {!editingStats ? (
                        <div className="font-semibold">{stats.studentsInPI ?? 0}</div>
                      ) : (
                        <input
                          type="number"
                          value={tempStats.studentsInPI ?? ''}
                          onChange={(e) => handleStatsChange('studentsInPI', e.target.value)}
                          className="border rounded px-1 py-0.5 w-16 text-sm"
                        />
                      )}
                    </div>
                    <div className="flex justify-between items-center">
                      <div>In GD</div>
                      {!editingStats ? (
                        <div className="font-semibold">{stats.studentsInGD ?? 0}</div>
                      ) : (
                        <input
                          type="number"
                          value={tempStats.studentsInGD ?? ''}
                          onChange={(e) => handleStatsChange('studentsInGD', e.target.value)}
                          className="border rounded px-1 py-0.5 w-16 text-sm"
                        />
                      )}
                    </div>
                    <div className="mt-2 text-xs text-slate-500">
                      Derived total (auto): <span className="font-medium">{derived.totalStudentsDerived}</span>
                    </div>
                  </div>
                </div>

                {/* Total Mentors card */}
                <div className="bg-gradient-to-br from-emerald-50 to-white p-4 rounded-lg border shadow-sm">
                  <div className="flex items-center justify-between mb-2">
                    <div className="flex items-center gap-2">
                      <Icons.Users className="text-emerald-600" />
                      <div>
                        <div className="text-xs text-slate-500">Total Mentors</div>
                        {!editingStats ? (
                          <div className="text-3xl font-bold text-emerald-700">{stats.totalMentors ?? 0}</div>
                        ) : (
                          <input
                            type="number"
                            value={tempStats.totalMentors ?? ''}
                            onChange={(e) => handleStatsChange('totalMentors', e.target.value)}
                            className="text-3xl font-bold text-emerald-700 border rounded px-2 py-1 w-28"
                          />
                        )}
                      </div>
                    </div>
                  </div>

                  <div className="text-sm text-slate-600 mt-2">
                    <div className="text-xs">Editable by admin</div>
                  </div>
                </div>

                {/* Total GDs card */}
                <div className="bg-gradient-to-br from-amber-50 to-white p-4 rounded-lg border shadow-sm">
                  <div className="flex items-center justify-between mb-2">
                    <div className="flex items-center gap-2">
                      <Icons.Calendar className="text-amber-600" />
                      <div>
                        <div className="text-xs text-slate-500">Total GDs</div>
                        <div className="text-3xl font-bold text-amber-700">{derived.totalGDs}</div>
                      </div>
                    </div>
                  </div>

                  <div className="text-sm text-slate-600 mt-2">
                    <div className="flex justify-between">
                      <div className="text-green-600 font-semibold">Completed</div>
                      <div>{derived.completedGDs}</div>
                    </div>
                    <div className="flex justify-between">
                      <div className="text-blue-600 font-semibold">In Progress</div>
                      <div>{derived.inProgressGDs}</div>
                    </div>
                    <div className="flex justify-between">
                      <div className="text-yellow-600 font-semibold">Waiting</div>
                      <div>{derived.pendingGDs}</div>
                    </div>
                  </div>
                </div>
              </div>

              {/* Stats edit actions */}
              {editingStats && (
                <div className="flex justify-end gap-2 mb-4">
                  <button onClick={handleCancelEdit} className="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Cancel</button>
                  <button onClick={handleSaveStats} className="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 flex items-center gap-2">
                    <Icons.Save /> Save Stats
                  </button>
                </div>
              )}

              <div className="flex gap-2 mb-4">
                <button
                  onClick={() => setSelectedView('tracker')}
                  className={`px-4 py-2 rounded-lg ${selectedView === 'tracker' ? 'bg-indigo-600 text-white' : 'bg-white border'}`}
                >
                  GD Tracker
                </button>
                <button
                  onClick={() => setSelectedView('add')}
                  className={`px-4 py-2 rounded-lg ${selectedView === 'add' ? 'bg-indigo-600 text-white' : 'bg-white border'}`}
                >
                  Add GD
                </button>
              </div>
            </div>

            {/* Tracker view */}
            {selectedView === 'tracker' && (
              <div className="bg-white rounded-2xl shadow p-6">
                <h2 className="text-2xl font-semibold mb-4">GD Groups ({gdGroups.length})</h2>

                {gdGroups.length === 0 ? (
                  <div className="text-center py-12 text-slate-500">
                    <p className="mb-4">No GD groups yet</p>
                    <button onClick={() => setSelectedView('add')} className="bg-indigo-600 text-white px-6 py-2 rounded-lg">Add Your First GD</button>
                  </div>
                ) : (
                  <div className="space-y-4">
                    {gdGroups.map(gd => (
                      <div key={gd.id} className="border rounded-lg p-4 hover:shadow-md transition-shadow">
                        {editingGD && editingGD.id === gd.id ? (
                          // Edit mode
                          <div className="space-y-4">
                            <div className="grid grid-cols-2 gap-4">
                              <div>
                                <label className="block text-sm font-medium mb-1">Timing</label>
                                <input
                                  type="text"
                                  value={editingGD.timing}
                                  onChange={(e) => setEditingGD({...editingGD, timing: e.target.value})}
                                  className="w-full border rounded px-3 py-2"
                                />
                              </div>
                              <div>
                                <label className="block text-sm font-medium mb-1">Group Name</label>
                                <input
                                  type="text"
                                  value={editingGD.groupName}
                                  onChange={(e) => setEditingGD({...editingGD, groupName: e.target.value})}
                                  className="w-full border rounded px-3 py-2"
                                />
                              </div>
                            </div>

                            <div>
                              <label className="block text-sm font-medium mb-1">Meet Link</label>
                              <input
                                type="url"
                                value={editingGD.meetLink}
                                onChange={(e) => setEditingGD({...editingGD, meetLink: e.target.value})}
                                className="w-full border rounded px-3 py-2"
                              />
                            </div>

                            <div>
                              <label className="block text-sm font-medium mb-1">Status</label>
                              <select
                                value={editingGD.status}
                                onChange={(e) => setEditingGD({...editingGD, status: e.target.value})}
                                className="border rounded px-3 py-2"
                              >
                                <option value="pending">Pending</option>
                                <option value="in-progress">In Progress</option>
                                <option value="completed">Completed</option>
                              </select>
                            </div>

                            <div className="border-t pt-4">
                              <div className="flex justify-between items-center mb-2">
                                <h4 className="font-semibold text-sm">Students</h4>
                                <button onClick={addEditingGDStudent} className="flex items-center gap-1 bg-indigo-600 text-white px-2 py-1 rounded text-xs">
                                  <Icons.Plus /> Add
                                </button>
                              </div>
                              {editingGD.students.map((student, idx) => (
                                <div key={idx} className="grid grid-cols-12 gap-2 mb-2 items-end">
                                  <div className="col-span-4">
                                    <input
                                      type="text"
                                      value={student.name}
                                      onChange={(e) => updateEditingGDStudent(idx, 'name', e.target.value)}
                                      placeholder="Name"
                                      className="w-full border rounded px-2 py-1 text-sm"
                                    />
                                  </div>
                                  <div className="col-span-4">
                                    <input
                                      type="email"
                                      value={student.email}
                                      onChange={(e) => updateEditingGDStudent(idx, 'email', e.target.value)}
                                      placeholder="Email"
                                      className="w-full border rounded px-2 py-1 text-sm"
                                    />
                                  </div>
                                  <div className="col-span-3">
                                    <input
                                      type="url"
                                      value={student.attachment}
                                      onChange={(e) => updateEditingGDStudent(idx, 'attachment', e.target.value)}
                                      placeholder="Attachment"
                                      className="w-full border rounded px-2 py-1 text-sm"
                                    />
                                  </div>
                                  <div className="col-span-1">
                                    <button onClick={() => removeEditingGDStudent(idx)} className="w-full bg-red-100 text-red-600 p-1 rounded">
                                      <Icons.X />
                                    </button>
                                  </div>
                                </div>
                              ))}
                            </div>

                            <div className="border-t pt-4">
                              <div className="flex justify-between items-center mb-2">
                                <h4 className="font-semibold text-sm">Panelists</h4>
                                <button onClick={addEditingGDPanelist} className="flex items-center gap-1 bg-green-600 text-white px-2 py-1 rounded text-xs">
                                  <Icons.Plus /> Add
                                </button>
                              </div>
                              {editingGD.panelists.map((panelist, idx) => (
                                <div key={idx} className="grid grid-cols-12 gap-2 mb-2 items-end">
                                  <div className="col-span-4">
                                    <input
                                      type="text"
                                      value={panelist.name}
                                      onChange={(e) => updateEditingGDPanelist(idx, 'name', e.target.value)}
                                      placeholder="Name"
                                      className="w-full border rounded px-2 py-1 text-sm"
                                    />
                                  </div>
                                  <div className="col-span-4">
                                    <input
                                      type="email"
                                      value={panelist.email}
                                      onChange={(e) => updateEditingGDPanelist(idx, 'email', e.target.value)}
                                      placeholder="Email"
                                      className="w-full border rounded px-2 py-1 text-sm"
                                    />
                                  </div>
                                  <div className="col-span-3">
                                    <input
                                      type="tel"
                                      value={panelist.phone}
                                      onChange={(e) => updateEditingGDPanelist(idx, 'phone', e.target.value)}
                                      placeholder="Phone"
                                      className="w-full border rounded px-2 py-1 text-sm"
                                    />
                                  </div>
                                  <div className="col-span-1">
                                    <button onClick={() => removeEditingGDPanelist(idx)} className="w-full bg-red-100 text-red-600 p-1 rounded">
                                      <Icons.X />
                                    </button>
                                  </div>
                                </div>
                              ))}
                            </div>

                            <div>
                              <label className="block text-sm font-medium mb-1">SPOCs</label>
                              <input
                                type="text"
                                value={editingGD.spocs}
                                onChange={(e) => setEditingGD({...editingGD, spocs: e.target.value})}
                                className="w-full border rounded px-3 py-2"
                              />
                            </div>

                            <div className="flex justify-end gap-2">
                              <button onClick={cancelEditingGD} className="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Cancel</button>
                              <button onClick={saveEditingGD} className="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 flex items-center gap-2">
                                <Icons.Save /> Save Changes
                              </button>
                            </div>
                          </div>
                        ) : (
                          // View mode
                          <>
                            <div className="flex justify-between items-start mb-3">
                              <div className="flex-1">
                                <div className="flex items-center gap-4 mb-2">
                                  <span className="text-lg font-bold text-indigo-600">{gd.groupName}</span>
                                  <span className="text-sm text-slate-500">{gd.timing}</span>

                                  <select
                                    value={gd.status}
                                    onChange={(e) => handleUpdateGD(gd.id, 'status', e.target.value)}
                                    className="text-xs border rounded px-2 py-1"
                                  >
                                    <option value="pending">Pending</option>
                                    <option value="in-progress">In Progress</option>
                                    <option value="completed">Completed</option>
                                  </select>
                                </div>

                                {gd.meetLink && (
                                  <a href={gd.meetLink} target="_blank" rel="noopener noreferrer" className="text-indigo-600 hover:underline text-sm">ðŸ”— Join Meeting with this link</a>
                                )}
                              </div>

                              <div className="flex items-center gap-3">
                                <button onClick={() => startEditingGD(gd)} className="text-indigo-600 hover:text-indigo-800">
                                  <Icons.Edit />
                                </button>
                                <button onClick={() => handleDeleteGD(gd.id)} className="text-red-600 hover:text-red-800">
                                  <Icons.Trash />
                                </button>
                              </div>
                            </div>

                            <div className="grid grid-cols-2 gap-4">
                              <div>
                                <h4 className="font-semibold text-sm mb-2">Students:</h4>
                                {gd.students && gd.students.length > 0 ? (
                                  <ul className="text-sm space-y-1">
                                    {gd.students.map((student, idx) => (
                                      <li key={idx} className="flex items-center gap-2">
                                        <span>â€¢ {student.name}</span>
                                        {student.attachment && (
                                          <a href={student.attachment} target="_blank" rel="noopener noreferrer" className="text-indigo-600">
                                            <Icons.Paperclip />
                                          </a>
                                        )}
                                      </li>
                                    ))}
                                  </ul>
                                ) : (
                                  <p className="text-sm text-slate-500">No students added</p>
                                )}
                              </div>

                              <div>
                                <h4 className="font-semibold text-sm mb-2">Panelists:</h4>
                                {gd.panelists && gd.panelists.length > 0 ? (
                                  <ul className="text-sm space-y-1">
                                    {gd.panelists.map((panelist, idx) => (
                                      <li key={idx}>â€¢ {panelist.name} ({panelist.phone})</li>
                                    ))}
                                  </ul>
                                ) : (
                                  <p className="text-sm text-slate-500">No panelists added</p>
                                )}
                              </div>
                            </div>

                            {gd.spocs && (
                              <div className="mt-3 pt-3 border-t">
                                <span className="text-xs text-slate-600">SPOCs: {gd.spocs}</span>
                              </div>
                            )}
                          </>
                        )}
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}

            {/* Add view */}
            {selectedView === 'add' && (
              <div className="bg-white rounded-2xl shadow p-6">
                <h2 className="text-2xl font-semibold mb-4">Add New GD</h2>

                <div className="space-y-6">
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium mb-1">Timing</label>
                      <input type="text" value={newGD.timing} onChange={(e) => setNewGD({...newGD, timing: e.target.value})} placeholder="e.g., 18:00" className="w-full border rounded px-3 py-2"/>
                    </div>
                    <div>
                      <label className="block text-sm font-medium mb-1">Group Name/Number</label>
                      <input type="text" value={newGD.groupName} onChange={(e) => setNewGD({...newGD, groupName: e.target.value})} placeholder="e.g., G1" className="w-full border rounded px-3 py-2"/>
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-medium mb-1">Meet Link</label>
                    <input type="url" value={newGD.meetLink} onChange={(e) => setNewGD({...newGD, meetLink: e.target.value})} placeholder="https://meet.google.com/..." className="w-full border rounded px-3 py-2"/>
                  </div>

                  {/* Students */}
                  <div className="border-t pt-4">
                    <div className="flex justify-between items-center mb-3">
                      <h3 className="font-semibold">Students</h3>
                      <button onClick={addStudent} className="flex items-center gap-1 bg-indigo-600 text-white px-3 py-1 rounded text-sm hover:bg-indigo-700">
                        <Icons.Plus /> Add Student
                      </button>
                    </div>

                    {newGD.students.map((student, idx) => (
                      <div key={idx} className="grid grid-cols-12 gap-2 mb-3 items-end">
                        <div className="col-span-4">
                          <input type="text" value={student.name} onChange={(e) => updateStudent(idx, 'name', e.target.value)} placeholder="Student Name" className="w-full border rounded px-3 py-2"/>
                        </div>
                        <div className="col-span-4">
                          <input type="email" value={student.email} onChange={(e) => updateStudent(idx, 'email', e.target.value)} placeholder="Email" className="w-full border rounded px-3 py-2"/>
                        </div>
                        <div className="col-span-3">
                          <input type="url" value={student.attachment} onChange={(e) => updateStudent(idx, 'attachment', e.target.value)} placeholder="Attachment URL (optional)" className="w-full border rounded px-3 py-2"/>
                        </div>
                        <div className="col-span-1">
                          <button onClick={() => removeStudent(idx)} className="w-full bg-red-100 text-red-600 p-2 rounded hover:bg-red-200">
                            <Icons.X />
                          </button>
                        </div>
                      </div>
                    ))}
                  </div>

                  {/* Panelists */}
                  <div className="border-t pt-4">
                    <div className="flex justify-between items-center mb-3">
                      <h3 className="font-semibold">Panelists</h3>
                      <button onClick={addPanelist} className="flex items-center gap-1 bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                        <Icons.Plus /> Add Panelist
                      </button>
                    </div>

                    {newGD.panelists.map((panelist, idx) => (
                      <div key={idx} className="grid grid-cols-12 gap-2 mb-3 items-end">
                        <div className="col-span-4">
                          <input type="text" value={panelist.name} onChange={(e) => updatePanelist(idx, 'name', e.target.value)} placeholder="Panelist Name" className="w-full border rounded px-3 py-2"/>
                        </div>
                        <div className="col-span-4">
                          <input type="email" value={panelist.email} onChange={(e) => updatePanelist(idx, 'email', e.target.value)} placeholder="Email" className="w-full border rounded px-3 py-2"/>
                        </div>
                        <div className="col-span-3">
                          <input type="tel" value={panelist.phone} onChange={(e) => updatePanelist(idx, 'phone', e.target.value)} placeholder="Phone" className="w-full border rounded px-3 py-2"/>
                        </div>
                        <div className="col-span-1">
                          <button onClick={() => removePanelist(idx)} className="w-full bg-red-100 text-red-600 p-2 rounded hover:bg-red-200">
                            <Icons.X />
                          </button>
                        </div>
                      </div>
                    ))}
                  </div>

                  <div>
                    <label className="block text-sm font-medium mb-1">SPOCs</label>
                    <input type="text" value={newGD.spocs} onChange={(e) => setNewGD({...newGD, spocs: e.target.value})} placeholder="e.g., JAY, ADITYA SINGH" className="w-full border rounded px-3 py-2"/>
                  </div>

                  <div className="flex gap-2 justify-end mt-6">
                    <button onClick={() => setSelectedView('tracker')} className="px-6 py-2 bg-gray-300 rounded-lg hover:bg-gray-400">Cancel</button>
                    <button onClick={handleAddGD} className="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 flex items-center gap-2">
                      <Icons.Save /> Save GD
                    </button>
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<GDTracker />);
  </script>
</body>
</html>
